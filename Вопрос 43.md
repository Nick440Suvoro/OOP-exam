# Вопрос 43
**Конструктор и деструктор: назначение, решаемые задачи, взаимодействие с средствами выделения памяти.**

**Конструктор** – это функция, которая работает в момент создания объекта класса.
* Конструктор имеет то же имя, что и класс.
* Конструктор ничего не возвращает, он настраивает значения полей и выделяет память под динамические массивы, которые используются в объекте.
* Чаще всего, конструкторы относятся к открытой зоне (public). 
* Конструктор служит для инициализации объяекта класса, поэтому его следует объявлять в `public`. *Стоит заметить, что в промышленном программировании могут встречаться случаи объявления конструктора в `private`. Конструктор помещается в секцию private в случаях, если нужно ограничить пользователя в возможностях создания объектов.* Пример:
```c++
class NonCopyable {
private:
   NonCopyable(const NonCopyable&) = delete;
   void operator=(const NonCopyable&) = delete;
};
```

При этом, зачастую конструкторов много для того, чтобы можно было в разных ситуациях давать разные наборы значений для атрибутов класса. Для того, чтобы этого добиться, применяется перегрузка функций.
  
Важное действие, которое производится в конструкторе, - это выделение памяти под динамические массивы, если они присутствуют в качестве атрибута класса.

Например, для класса строка `BaseString`, где

- `p` – указатель на первый элемент массива `char`
- `len` – количество заполненных элементов 
- `capacity` – объём выделенной памяти  

необходимо выделить память под массив `p`. В примере представлено два конструктора: конструктор с одним параметром и конструктор копий. 

```c++
class BaseString
{
private:
    char* p;
    int len;
    int capacity;
public:
    BaseString(char* ptr)
    {
        len = strlen(ptr) + 1;
        capacity = 256;
        p = new char[capacity];
        for(int i=0;i<len;i++)
        {
            p[i] = ptr[i];
        }
        p[len] = '\0';
    }
    BaseString(int Capacity = 256)
    {
        capacity = Capacity;
        p = new char[capacity];
        len = 0;
    }
//…
}
```

**Деструктор** - это функция, которя служит для освобождения выделенной конструктором под объект класса памяти и удаления самого объекта класса.

* Имеет то же имя, что и класс.
* Чтобы отличать деструктор от конструкторов, в названии
используют тильду `~`.
* Деструктор может быть только один – он не перегружается и не
принимает параметров. Так делается потому, что обычно он вызывается автоматически.

**Явные вызовы деструктора**
Редко возникает необходимость в явном вызове деструктора. Однако может быть полезно выполнить удаление объектов, размещенных по абсолютным адресам. Эти объекты обычно выделяются с помощью определяемого new пользователем оператора, который принимает аргумент размещения. Оператор delete не может освободить эту память, так как он не выделяется из свободного хранилища. Вызов деструктора, однако, может выполнить соответствующую очистку. Для явного вызова деструктора для объекта (s) класса String воспользуйтесь одним из следующих операторов.

**Порядок уничтожения:**

Когда объект выходит за пределы области или удаляется, последовательность событий при его полном уничтожении выглядит следующим образом:

* Вызывается деструктор класса, и выполняется тело функции деструктора.

* Деструкторы для объектов нестатических членов вызываются в порядке, обратном порядку их появления в объявлении класса. Список инициализации необязательных элементов, используемый при построении этих элементов, не влияет на порядок строительства или уничтожения.

* Деструкторы для не виртуальных базовых классов вызываются в обратном порядке объявления.

* Деструкторы для виртуальных базовых классов вызываются в порядке, обратном порядку их объявления.

Важно понимать, что деструктор класса вызывается для всех объектов имееющих тип класса (за исключением ссылок или указателей).

Например, деструктор класса `BaseString`, приведённого выше как пример, работает следующим образом:

```c++
class BaseString
{
protected:
    char* p;
    int len;
    int capacity;
public:
//…
    ~BaseString()
    {
        if(p!=NULL)
            delete[] p;
        len = 0;
    }
};
```